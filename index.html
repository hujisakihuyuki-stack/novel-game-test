<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ノベルゲームサンプル</title>
<style>
  body {
    margin: 0;
    background-color: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  #game {
    width: 800px;
    height: 450px; /* 16:9 */
    background-color: #000;
    position: relative;
    overflow: hidden;
    border: 2px solid #444;
  }
  #background {
    position: absolute;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 1;
  }
  #character {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    height: 90%; /* 立ち絵の高さ */
    z-index: 10; /* 背景より前に出す */
  }
  #text-box {
  position: absolute;
  bottom: 20px;
  left: 20px;
  right: 20px;
  height: 60px; /* 最大2行分固定 */
  background: rgba(0,0,0,0.6);
  color: #fff;
  padding: 10px;
  box-sizing: border-box;
  font-size: 18px;
  z-index: 20;
  overflow: hidden;
}

#restart-btn {
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 30;
  padding: 5px 10px;
}

  #choices {
    position: absolute;
    bottom: 80px;
    width: 100%;
    text-align: center;
    z-index: 20;
  }
  .choice-btn {
    margin: 5px;
    padding: 8px 16px;
    font-size: 16px;
  }
</style>
</head>
<body>
<div id="game">
  <!-- ここをアップロードした背景・キャラのファイル名に変更 -->
  <img id="background" src="background-test.jpg" alt="背景">
  <img id="character" src="character-test.png" alt="キャラ">
  
  <div id="text-box">こんにちは！これはサンプルのテキストです。</div>
  <div id="choices">
    <button class="choice-btn" onclick="choose(1)">選択肢1</button>
    <button class="choice-btn" onclick="choose(2)">選択肢2</button>
  </div>
</div>

<script>
let step = 0;
let firstChoice = 0;
let secondChoice = 0;

// 選択肢を押したときの処理
function choose(n){
  if(step === 0){
    firstChoice = n;
    step = 1;
    if(n === 1){
      showSequence(["1回目の選択肢を選びました","A","A-1","A-1a"]);
    } else {
      showSequence(["1回目の選択肢を選びました","B","B-1","B-1a"]);
    }
    updateChoicesAfterStep1(n);
  } else if(step === 2){
    secondChoice = n;
    step = 3;
    showThirdStep(n);
  }
}

// 1回目の選択後に2回目の選択肢を表示
function updateChoicesAfterStep1(n){
  setTimeout(() => {
    if(n === 1){
      updateChoices("A-1","A-2");
    } else {
      updateChoices("B-1","B-2");
    }
    step = 2; // 次は2回目選択
  }, 3000); // 3秒待って選択肢表示
}

// 3回目（最終ゴール）処理
function showThirdStep(n){
  let result = "";
  if(firstChoice === 1 && secondChoice === 1){
    result = (n===1)?"A-1a":"A-1b";
  } else if(firstChoice === 1 && secondChoice === 2){
    result = (n===1)?"A-2a":"A-2b";
  } else if(firstChoice === 2 && secondChoice === 1){
    result = (n===1)?"B-1a":"B-1b";
  } else { // B-2はランダム
    let goals = ["A-1a","A-1b","A-2a","A-2b","B-1a","B-1b","B-2c"];
    result = goals[Math.floor(Math.random() * goals.length)];
  }
  showSequence(["ゴール到達！", result]);
  document.getElementById('choices').innerHTML = ""; // 選択肢消す
}

// テキストを順番に表示（自動3秒）
function showSequence(sequence){
  let i = 0;
  function nextText(){
    if(i >= sequence.length) return;
    document.getElementById('text-box').innerText = sequence[i];
    i++;
    setTimeout(nextText, 3000);
  }
  nextText();
}

// 選択肢ボタン生成
function updateChoices(opt1,opt2){
  document.getElementById('choices').innerHTML = `
    <button class="choice-btn" onclick="choose(1)">${opt1}</button>
    <button class="choice-btn" onclick="choose(2)">${opt2}</button>
  `;
}

// 最初からやり直すボタン
function restart(){
  step = 0;
  firstChoice = 0;
  secondChoice = 0;
  document.getElementById('text-box').innerText = "こんにちは！これはサンプルのテキストです。";
  updateChoices("選択肢1","選択肢2");
}
</script>
<button id="restart-btn" onclick="restart()">やり直す</button>
</body>
</html>
