<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ノベルゲームサンプル</title>
<style>
  body {
    margin: 0;
    background-color: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  #game {
    width: 800px;
    height: 450px; /* 16:9 */
    background-color: #000;
    position: relative;
    overflow: hidden;
    border: 2px solid #444;
  }
  #background {
    position: absolute;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 1;
  }
  #character {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    height: 90%; /* 立ち絵の高さ */
    z-index: 10; /* 背景より前に出す */
  }
  #text-box {
  position: absolute;
  bottom: 20px;
  left: 20px;
  right: 20px;
  height: 60px; /* 最大2行分固定 */
  background: rgba(0,0,0,0.6);
  color: #fff;
  padding: 10px;
  box-sizing: border-box;
  font-size: 18px;
  z-index: 20;
  overflow: hidden;
}

#restart-btn {
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 30;
  padding: 5px 10px;
  display: none; /* ← 最初は隠す */
}

  #choices {
    position: absolute;
    bottom: 80px;
    width: 100%;
    text-align: center;
    z-index: 20;
  }
  .choice-btn {
    margin: 5px;
    padding: 8px 16px;
    font-size: 16px;
  }
</style>
</head>
<body>
<div id="game">
  <!-- ここをアップロードした背景・キャラのファイル名に変更 -->
  <img id="background" src="background-test.jpg" alt="背景">
  <img id="character" src="character-test.png" alt="キャラ">
  
  <div id="text-box">こんにちは！これはサンプルのテキストです。</div>
  <div id="choices">
    <button class="choice-btn" onclick="choose(1)">選択肢1</button>
    <button class="choice-btn" onclick="choose(2)">選択肢2</button>
  </div>
  <button id="restart-btn" onclick="restart()">やり直す</button>
</div>

<script>
let step = 0;
let firstChoice = 0;
let secondChoice = 0;

function choose(n){
  step++;

  if(step === 1){
    firstChoice = n;
    if(n===1){
      showTextThenChoices("A を選びました",1);
    } else {
      showTextThenChoices("B を選びました",1);
    }
  }
  else if(step === 2){
    secondChoice = n;
    if(firstChoice===1 && secondChoice===1){
      showTextThenChoices("A-1 を選びました",2);
    } else if(firstChoice===1 && secondChoice===2){
      showTextThenChoices("A-2 を選びました",2);
    } else if(firstChoice===2 && secondChoice===1){
      showTextThenChoices("B-1 を選びました",2);
    } else {
      showTextThenChoices("B-2 を選びました",2);
    }
  }
  else if(step === 3){
    let goalText = "";
    let final = true;

    if(firstChoice===1 && secondChoice===1){
      goalText = (n===1) ? "A-1a に到達！" : "A-1b に到達！";
    } else if(firstChoice===1 && secondChoice===2){
      goalText = (n===1) ? "A-2a に到達！" : "A-2b に到達！";
    } else if(firstChoice===2 && secondChoice===1){
      goalText = (n===1) ? "B-1a に到達！" : "B-1b に到達！";
    } else if(firstChoice===2 && secondChoice===2){
      // B-2だけランダム
      let pool = ["A-1a","A-1b","A-2a","A-2b","B-1a","B-1b","B-2c"];
      let rand = pool[Math.floor(Math.random()*pool.length)];
      goalText = rand + " に到達！（ランダム）";
    }
    showTextThenChoices(goalText,3,true);
  }
}

function showTextThenChoices(text, currentStep, final=false){
  document.getElementById('text-box').innerText = text;
  document.getElementById('choices').style.display = "none";

  if(final){
    // ゴール時 → 3秒後に「やり直す」ボタン表示
    setTimeout(()=>{
      document.getElementById('restart-btn').style.display = "block";
    }, 3000);
    return;
  }

  setTimeout(()=>{
    document.getElementById('choices').style.display = "block";
    if(currentStep === 1){
      if(firstChoice===1){
        updateChoices("A-1","A-2");
      } else {
        updateChoices("B-1","B-2");
      }
    } else if(currentStep === 2){
      updateChoices("最終選択肢1","最終選択肢2");
    }
  },3000);
}

function updateChoices(text1,text2){
  let btns = document.getElementsByClassName("choice-btn");
  btns[0].innerText = text1;
  btns[1].innerText = text2;
}

function restart(){
  step = 0;
  firstChoice = 0;
  secondChoice = 0;
  document.getElementById('text-box').innerText = "こんにちは！これはサンプルのテキストです。";
  updateChoices("選択肢1","選択肢2");
  document.getElementById('choices').style.display = "block";
  document.getElementById('restart-btn').style.display = "none"; // リセット時に隠す
}
</script>


</body>
</html>
